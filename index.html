<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Bikoin Evolution: Firebase Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #000; color: #fff; text-align: center; margin: 0; padding: 0; overflow: hidden; }
        .header { background: #111; padding: 15px; border-bottom: 2px solid #f1c40f; color: #f1c40f; font-weight: bold; }
        #balance { font-size: 2.5em; margin: 15px 0; text-shadow: 0 0 10px #f1c40f; }
        .coin-container { height: 250px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .coin { width: 200px; cursor: pointer; transition: transform 0.1s; filter: drop-shadow(0 0 15px rgba(241,196,15,0.5)); }
        .coin:active { transform: scale(0.9); }
        #rank-badge { background: #f1c40f; color: #000; padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-top: 10px; font-size: 0.8em; }
        .tabs { display: flex; position: fixed; bottom: 0; width: 100%; background: #111; height: 70px; border-top: 1px solid #333; }
        .tab { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #666; font-size: 0.8em; cursor: pointer; }
        .tab.active { color: #f1c40f; }
        .content { display: none; padding: 20px; height: 65vh; overflow-y: auto; }
        .content.active { display: block; }
        .upgrade-card { background: #1a1a1a; padding: 12px; margin: 8px 0; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        .btn { background: #f1c40f; color: #000; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; }
        .leader-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #222; }
    </style>
</head>
<body>

<div class="header">üö≤ @<span id="username">Guest</span></div>
<div id="balance">0 ‚Ç∏</div>

<div id="game-tab" class="content active">
    <div class="coin-container">
        <img id="bike-img" src="https://cdn-icons-png.flaticon.com/512/2972/2972185.png" class="coin" onclick="clickCoin()">
        <div id="rank-badge">–†–∞–Ω–≥: –£—Ä–∞–ª–µ—Ü</div>
    </div>
    <div style="margin-top: 20px; color: #aaa;">–ö–ª–∏–∫: <span id="cpc">1</span> | –ê–≤—Ç–æ: <span id="cps">0</span></div>
</div>

<div id="shop-tab" class="content">
    <h2 style="color: #f1c40f;">–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –ê–∫–µ—Å—É</h2>
    <div class="upgrade-card">
        <div><strong>–¢—É—Ä–±–æ-–ø–µ–¥–∞–ª–∏</strong><br><small>–ö–ª–∏–∫ +1</small></div>
        <button class="btn" onclick="buyUpgrade('click')" id="upg-click">50 ‚Ç∏</button>
    </div>
    <div class="upgrade-card">
        <div><strong>–°–º–∞–∑–∫–∞ —Ü–µ–ø–∏</strong><br><small>–ê–≤—Ç–æ +2/—Å</small></div>
        <button class="btn" onclick="buyUpgrade('auto')" id="upg-auto">200 ‚Ç∏</button>
    </div>
</div>

<div id="top-tab" class="content">
    <h2 style="color: #f1c40f;">üèÜ –¢–æ–ø –õ–∏–¥–µ—Ä–æ–≤</h2>
    <div id="leaderboard-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<div class="tabs">
    <div class="tab active" onclick="openTab('game-tab', this)">üöÄ –ö–õ–ò–ö</div>
    <div class="tab" onclick="openTab('shop-tab', this)">üõ†Ô∏è –¢–Æ–ù–ò–ù–ì</div>
    <div class="tab" onclick="openTab('top-tab', this)">üèÜ –¢–û–ü</div>
</div>

<script>
    // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyDR4dwkwzvM_-jpfwC4E4YWg-kXOh2EvHo",
        authDomain: "stalinclicker.firebaseapp.com",
        projectId: "stalinclicker",
        storageBucket: "stalinclicker.firebasestorage.app",
        messagingSenderId: "266501925938",
        appId: "1:266501925938:web:a4aeba79507602d8c2202b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---
    let tg = window.Telegram.WebApp;
    tg.expand();
    let userId = tg.initDataUnsafe?.user?.id || "local_user";
    let userName = tg.initDataUnsafe?.user?.username || "Gamer";
    document.getElementById('username').innerText = userName;

    let balance = 0;
    let clickPower = 1;
    let autoPower = 0;
    let clickCost = 50;
    let autoCost = 200;

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    db.ref('users/' + userId).once('value').then((snapshot) => {
        if (snapshot.exists()) {
            let data = snapshot.val();
            balance = data.balance || 0;
            clickPower = data.clickPower || 1;
            autoPower = data.autoPower || 0;
            clickCost = data.clickCost || 50;
            autoCost = data.autoCost || 200;
            updateUI();
        }
    });

    function saveToDB() {
        db.ref('users/' + userId).set({
            username: userName,
            balance: Math.floor(balance),
            clickPower: clickPower,
            autoPower: autoPower,
            clickCost: clickCost,
            autoCost: autoCost,
            lastUpdate: Date.now()
        });
    }

    function updateUI() {
        document.getElementById('balance').innerText = Math.floor(balance).toLocaleString() + ' ‚Ç∏';
        document.getElementById('cpc').innerText = clickPower;
        document.getElementById('cps').innerText = autoPower;
        document.getElementById('upg-click').innerText = clickCost + ' ‚Ç∏';
        document.getElementById('upg-auto').innerText = autoCost + ' ‚Ç∏';
        document.getElementById('upg-click').disabled = balance < clickCost;
        document.getElementById('upg-auto').disabled = balance < autoCost;
    }

    function clickCoin() {
        balance += clickPower;
        updateUI();
        saveToDB();
        if (window.navigator.vibrate) window.navigator.vibrate(10);
    }

    function buyUpgrade(type) {
        if (type === 'click' && balance >= clickCost) {
            balance -= clickCost;
            clickPower += 1;
            clickCost = Math.floor(clickCost * 1.6);
        } else if (type === 'auto' && balance >= autoCost) {
            balance -= autoCost;
            autoPower += 2;
            autoCost = Math.floor(autoCost * 1.7);
        }
        updateUI();
        saveToDB();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –õ–∏–¥–µ—Ä–±–æ—Ä–¥–∞
    function updateLeaderboard() {
        db.ref('users').orderByChild('balance').limitToLast(10).once('value', (snapshot) => {
            let list = [];
            snapshot.forEach((child) => {
                list.push(child.val());
            });
            list.reverse();
            let html = '';
            list.forEach((user, index) => {
                html += `<div class="leader-item">
                    <span>${index + 1}. @${user.username}</span>
                    <span style="color:#f1c40f">${Math.floor(user.balance).toLocaleString()} ‚Ç∏</span>
                </div>`;
            });
            document.getElementById('leaderboard-list').innerHTML = html;
        });
    }

    setInterval(() => { 
        if (autoPower > 0) {
            balance += autoPower / 10; 
            updateUI(); 
        }
    }, 100);

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å
    setInterval(saveToDB, 5000);

    function openTab(id, el) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
        if (id === 'top-tab') updateLeaderboard();
    }

    updateUI();
</script>
</body>
</html>

